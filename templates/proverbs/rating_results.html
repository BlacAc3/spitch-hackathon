{% extends 'base.html' %}

{% block content %}
    <div class="mb-8 flex items-center text-left">
        <a
            href="{% url 'proverb_list' %}"
            class="bg-orange-500 text-white font-bold py-2 px-4 rounded-xl shadow-md backdrop-blur-md bg-opacity-80 hover:bg-opacity-90 transition-all duration-300"
        >
            &#x2190; Back to Proverb List
        </a>
    </div>

    <h1 class="text-3xl font-bold text-slate-800 mb-8 knewave-regular">TTS Rating Results</h1>

    {% if proverb %}
        <div class="my-4 p-4 bg-slate-100/50 rounded-lg border border-slate-400 mb-8">
            <h2 class="text-2xl font-semibold text-slate-700 mb-2">Results for Proverb:</h2>
            <blockquote class="text-xl italic text-gray-900">
                "{{ proverb.text }}"
            </blockquote>
            <p class="text-md text-slate-600 mt-2"><strong>Translation:</strong> {{ proverb.translation }}</p>
        </div>
    {% else %}
        <h2 class="text-2xl font-semibold text-slate-700 mb-4">Overall TTS System Performance</h2>
    {% endif %}

    {% if total_ratings > 0 %}
        <div class="py-6 px-4 sm:px-8 rounded-lg backdrop-blur-lg bg-white/40 border border-stone-700 shadow-lg mb-8">
            <h2 class="text-2xl font-bold text-slate-700 mb-6 border-b border-stone-500 pb-2">Summary of Results</h2>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 text-center mb-8">
                <div class="p-4 bg-slate-200/50 rounded-lg border border-slate-400">
                    <p class="text-sm font-semibold text-slate-600">Total Ratings</p>
                    <p class="text-3xl font-bold text-slate-800">{{ total_ratings }}</p>
                </div>
                <div class="p-4 bg-slate-200/50 rounded-lg border border-slate-400">
                    <p class="text-sm font-semibold text-slate-600">Average Final Rating</p>
                    <p class="text-3xl font-bold text-slate-800">{{ avg_final_rating|floatformat:2 }} <span class="text-lg text-slate-600">/ 5</span></p>
                </div>
                {% if avg_competence_score is not None %}
                    <div class="p-4 bg-slate-200/50 rounded-lg border border-slate-400">
                        <p class="text-sm font-semibold text-slate-600">Avg. Competence</p>
                        <p class="text-3xl font-bold text-slate-800">{{ avg_competence_score|floatformat:2 }} <span class="text-lg text-slate-600">/ 3</span></p>
                    </div>
                    <div class="p-4 bg-slate-200/50 rounded-lg border border-slate-400">
                        <p class="text-sm font-semibold text-slate-600">Expert Raters</p>
                        <p class="text-3xl font-bold text-slate-800">{{ expert_percentage|floatformat:1 }}%</p>
                    </div>
                {% endif %}
            </div>

            <h3 class="text-xl font-semibold mt-8 mb-4 text-slate-800">Key Performance Indicators</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <div class="p-4 bg-slate-100/50 rounded-lg border border-slate-400"><strong>Clarity (Q4):</strong> <span class="font-mono">{{ avg_q4|floatformat:2 }} / 5</span></div>
                <div class="p-4 bg-slate-100/50 rounded-lg border border-slate-400"><strong>Natural Flow (Q5):</strong> <span class="font-mono">{{ q5_natural_percentage|floatformat:2 }}%</span></div>
                <div class="p-4 bg-slate-100/50 rounded-lg border border-slate-400"><strong>Tone Accuracy (Q6):</strong> <span class="font-mono">{{ avg_q6|floatformat:2 }} / 5</span></div>
                <div class="p-4 bg-slate-100/50 rounded-lg border border-slate-400"><strong>Fluency/Voice (Q7):</strong> <span class="font-mono">{{ q7_natural_percentage|floatformat:2 }}%</span></div>
                <div class="p-4 bg-slate-100/50 rounded-lg border border-slate-400"><strong>Accent (Q8):</strong> <span class="font-mono">{{ q8_native_percentage|floatformat:2 }}%</span></div>
                <div class="p-4 bg-slate-100/50 rounded-lg border border-slate-400"><strong>Meaning (Q9):</strong> <span class="font-mono">{{ q9_preserved_percentage|floatformat:2 }}%</span></div>
            </div>

            <h3 class="text-xl font-semibold mt-8 mb-4 text-slate-800">Overall Impression Distribution (Q10)</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4">
                <div class="p-4 bg-green-200/60 rounded-lg border border-green-500 text-center"><strong>Excellent (5):</strong><br><span class="text-2xl font-bold">{{ q10_5_percentage|floatformat:1 }}%</span></div>
                <div class="p-4 bg-lime-200/60 rounded-lg border border-lime-500 text-center"><strong>Good (4):</strong><br><span class="text-2xl font-bold">{{ q10_4_percentage|floatformat:1 }}%</span></div>
                <div class="p-4 bg-yellow-200/60 rounded-lg border border-yellow-500 text-center"><strong>Fair (3):</strong><br><span class="text-2xl font-bold">{{ q10_3_percentage|floatformat:1 }}%</span></div>
                <div class="p-4 bg-orange-200/60 rounded-lg border border-orange-500 text-center"><strong>Poor (2):</strong><br><span class="text-2xl font-bold">{{ q10_2_percentage|floatformat:1 }}%</span></div>
                <div class="p-4 bg-red-200/60 rounded-lg border border-red-500 text-center"><strong>Very Poor (1):</strong><br><span class="text-2xl font-bold">{{ q10_1_percentage|floatformat:1 }}%</span></div>
            </div>


        </div>

        <!--<div class="py-6 px-4 sm:px-8 rounded-lg backdrop-blur-lg bg-white/40 border border-stone-700 shadow-lg mb-8">
            <h2 class="text-2xl font-bold text-slate-700 mb-6 border-b border-stone-500 pb-2">Individual Feedback (Last 5 Ratings)</h2>
            {% if recent_ratings %}
                <div class="space-y-4">
                    {% for rating in recent_ratings %}
                        <div class="bg-slate-100/50 border border-slate-400 p-4 rounded-lg shadow-sm">
                            <div class="flex justify-between items-start mb-3">
                                <div>
                                    <span class="font-bold text-lg text-slate-800">Overall: {{ rating.final_rating }} / 5</span>
                                    <span class="ml-4 text-sm text-slate-600">(Competence: {{ rating.competence_score }}/3)</span>
                                </div>
                                <p class="text-xs text-gray-500 text-right">{{ rating.rated_at|date:"M d, Y H:i" }}</p>
                            </div>
                            <div class="grid grid-cols-2 md:grid-cols-3 gap-2 text-sm">
                                <p><strong>Clarity:</strong> {{ rating.q4 }}</p>
                                <p><strong>Flow:</strong> {{ rating.q5 }}</p>
                                <p><strong>Tones:</strong> {{ rating.q6 }}</p>
                                <p><strong>Fluency:</strong> {{ rating.q7 }}</p>
                                <p><strong>Accent:</strong> {{ rating.q8 }}</p>
                                <p><strong>Meaning:</strong> {{ rating.q9 }}</p>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p class="text-onSurface italic">No individual ratings to display.</p>
            {% endif %}
        </div>-->

    {% else %}
        <div class="py-6 px-4 sm:px-8 rounded-lg backdrop-blur-lg bg-white/40 border border-stone-700 shadow-lg mb-8 text-center">
            <p class="text-lg text-onSurface">No ratings available yet.</p>
            <p class="text-md text-slate-600 mt-2">Be the first to rate this proverb!</p>
        </div>
    {% endif %}
{% endblock %}
